#!/bin/bash
set -e

cd ../../apps/storybook && npx storybook build && cd ../../packages/e2e

# Use x86_64 platform to ensure Chrome is available 
docker run --rm --ipc=host --platform linux/amd64 \
  -v ${PWD%/*/*}:/tests -v /tests/node_modules \
  mcr.microsoft.com/playwright:v1.57.0-noble \
  /bin/bash -c "cd /tests && npm ci --legacy-peer-deps && npx playwright install chrome && npx start-server-and-test 'npx http-server /tests/apps/storybook/storybook-static -p 6006' 6006 'cd packages/e2e && npx playwright test --update-snapshots'"
